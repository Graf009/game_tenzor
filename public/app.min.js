var ticTacToe={gameId:null,mark:null,i:!1,interval:null,init:function(){$(function(){var t=io.connect("http://"+window.location.hostname+":3000");$("#find").hide().click(function(){$("#find").off("click").click(function(){window.location.reload()}),t.emit("start")}),t.on("connect",function(){$("#status").html("Успешно подключились к игровому серверу"),$("#find").show()}),t.on("reconnect",function(){$("#find").show(),$("#connect-status").html("Переподключились, продолжайте игру")}),t.on("reconnecting",function(){$("#find").hide(),$("#status").html("Соединение с сервером потеряно, переподключаемся...")}),t.on("error",function(t){$("#status").html("Ошибка: "+(t?t:"неизвестная ошибка"))}),t.on("wait",function(){$("#find").addClass("wait").text("Ожидаем соперника...")}),t.on("exit",function(){ticTacToe.endGame(ticTacToe.turn,"exit")}),t.on("timeout",function(t){ticTacToe.endGame(t,"timeout")}),t.on("ready",function(i,n,a,e){$("#status").html("К вам подключился соперник! Игра началась! "+("X"==n?"Сейчас Ваш первый ход":"Сейчас ходит соперник")+"!"),ticTacToe.startGame(i,n,a,e),$("#stats").append($("<li/>").attr("class","mark").html("Вы играете: <b>"+("X"==n?"Крестиком":"Ноликом")+"</b>")),$("#board-table td").click(function(i){ticTacToe.i&&t.emit("step",ticTacToe.gameId,i.target.id)})}),t.on("step",function(t,i,n){ticTacToe.move(t,i,n)}),t.on("stats",function(t){var i=$("#stats");i.find("li").not(".mark").remove();for(val in t)i.prepend($("<li/>").html(t[val]))})})},startGame:function(t,i,n,a){this.gameId=t,this.mark=i,this.i="X"==i,$("#find").hide();for(var e=$("#board-table").empty(),o=1;a>=o;o++){for(var c=$("<tr/>"),s=0;n>s;s++)c.append($("<td/>").attr("id",s+1+"x"+o).html("&nbsp;"));e.append(c)}$("#board,#timer").show(),this.mask(!this.i)},mask:function(t){var i=$("#mask"),n=$("#board-table");if(clearInterval(this.interval),$("#timer-label").show(),$("#timer").html(15),this.interval=setInterval(function(){var t=parseInt($("#timer").html());t--,$("#timer").html(t)},1e3),t){i.show();{n.position()}i.css({width:n.width(),height:n.height()})}else i.hide()},move:function(t,i,n){this.i=i!=this.mark,$("#"+t).html(i),n?this.endGame(i,n):(this.mask(!this.i),$("#status").html("Сейчас "+(this.i?"ваш ход":"ходит соперник")))},endGame:function(t,i){clearInterval(this.interval);var n="";switch(i){case"none":n="Ничья!";break;case"timeout":n=t==this.mark?"Слишком долго думали! Вы проиграли!":"Соперник так и не смог решить как ему ходить! Вы победили!";break;case"exit":n="Соперник сбежал с поля боя! Игра закончена";break;default:n="Вы "+(this.i?"проиграли! =(":"выиграли! =)")}$("<div/>",{"class":"notify",text:n}).click(function(){window.location.reload()}).appendTo("#notify-container"),$("<div/>",{"class":"notify",text:"Попробовать еще раз"}).click(function(){window.location.reload()}).appendTo("#notify-container")}};ticTacToe.init();